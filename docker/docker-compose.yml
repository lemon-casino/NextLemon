# NextLemon - OCR + Inpaint 服务
# 用于 PPT 可编辑导出功能
#
# 使用方法:
#   cd docker
#   docker-compose up -d
#
# 服务地址:
#   - EasyOCR: http://127.0.0.1:8866
#   - IOPaint: http://127.0.0.1:8080
#
# 首次启动需要下载模型，请耐心等待（约 3-5 分钟）

services:
  # EasyOCR 服务 - 文字检测和识别（轻量级，ARM 兼容）
  easyocr:
    build:
      context: .
      dockerfile: Dockerfile.easyocr
    container_name: next-easyocr
    ports:
      - "8866:8866"
    volumes:
      - easyocr_models:/root/.EasyOCR
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 1G

  # IOPaint 服务 - AI 背景修复
  iopaint:
    build:
      context: .
      dockerfile: Dockerfile.iopaint
    container_name: next-iopaint
    ports:
      - "8080:8080"
    volumes:
      - iopaint_models:/root/.cache
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 4G
        reservations:
          memory: 1G

volumes:
  easyocr_models:
  iopaint_models:
